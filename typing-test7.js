const passages = [
  `"I have done what so many Sith pretend to do but never really achieve... I have broken my chains. I will never again have a master. I will never let another rule over me. I will never return to the Empire." ― Darth Malgus`,

  `Darth Malgus was a Human male Sith Lord of the resurgent Sith Empire during the time of the Great Galactic War to the Third Galactic War. He was born under the name Veradun within Imperial space and raised by his adoptive father. While still young Veradun killed a Twi'lek servant on his father's estate revealing the dark will behind his sensitivity to the Force. The young boy was subsequently sent to the Sith Academy on the Imperial capital of Dromund Kaas where he became a Sith Warrior and a successful commander of the Imperial Military. During a trip to the Outer Rim world of Geonosis Veradun discovered the Twi'lek slave girl Eleena Daru and took her as his own. Although she was technically his slave the two fell in love with one another and fought side by side in many battles during the Great Galactic War against the Galactic Republic. Veradun later eschewed his birth name and adopted the Sith moniker of Darth Malgus.
  
  In the beginning Malgus and his master Darth Vindican had led the victorious recapture of the Sith world Korriban before the former struck down the latter for being injured at the hands of Jedi Master Kao Cen Darach. At the height of the war Malgus led a surprise assault on the Core World of Alderaan; though initially successful Malgus and his forces were defeated in a concentrated Republic counterattack led by his nemesis from Korriban future Grand Master Satele Shan. The Sith Lord was heavily wounded during the battle and was forced to wear a respirator for the remainder of his life. In 3653 BBY the Empire entered into sham peace negotiations with the Republic which were truthfully nothing more than a distraction from the Sith's true target: the Republic capital of Coruscant. Malgus was chosen by his superior Darth Angral to participate in the attack on Coruscant as the leader of a strike team that would invade the Jedi Temple. Malgus succeeded in killing a substantial number of Jedi defenders — including Jedi Master Ven Zallow who has been recognized as Malgus's most notable kill — before the Sith fleet arrived to lay waste to the rest of the world. By the end of the engagement the Sith had destroyed the Jedi Temple killed half of the members of the Jedi High Council and disgraced the Jedi Order in the eyes of the Republic.
  
  Although Malgus had been under the impression that the Imperial Armada was going to raze Coruscant and destroy the Republic once and for all the battle was ultimately used only as leverage in the peace negotiations on Alderaan. While the Alderaanian summit progressed the Sith settled into an occupation of Coruscant. Malgus was placed in charge of orbital security but the Sith Lord defied his orders and traveled back to Coruscant's surface to strike against the renegade Jedi Aryn Leneer who was targeting Malgus for his murder of her Master Ven Zallow. Although Leneer ultimately failed the conflict caused Malgus to become disillusioned with the Empire and to review his relationship with Daru as a weakness. Thus he was forced to kill his lover to preserve his own power which he later used to cleanse the Empire of the politicians whom he blamed for allowing the Republic to survive. During the Cold War years that followed the successful peace negotiations Malgus led Sith forces into the Unknown Regions claiming previously-unknown territories for the Empire.
  
  Towards the end of the Cold War following the presumed death of the Sith Emperor and after serving on the Dark Council Malgus came to the fore and declared a new Empire one free of the infighting of the Dark Council. However in time he was tracked down to his secret base and was defeated by the Republic and the Empire.
  
  Malgus made his return during the Invasion of Ossus at the start of the Third Galactic War serving under Emperor Vowrawn and the Sith Empire becoming a military commander for them once more. However following the Meridian Complex assault Malgus went rogue determined to expunge all physical and mental restraints used to keep him under control.
  
  Early Life: Veradun was a Force-sensitive Human male born in the year 3700 BBY[2] on the planet Dromund Kaas the capital of the reconstituted Sith Empire.[1] Veradun was raised by an adoptive father a biologist in the Imperial Science Bureau and the man maintained a private zoo on a planet other than Dromund Kaas with funding from the Empire where he collected and studied many different animals. As a child Veradun tended to the creatures in the menagerie feeding the animals and cleaning their cages. The young boy also participated in lessons on the Force with a number of instructors all of whom recognized his great potential in the Force.[11]
  
  Sometime in his youth a female Twi'lek servant on the estate of Veradun's father committed a minor offense. Although the offense itself was meaningless to Veradun he killed the woman to prove to himself that he was capable of doing so. His father was pleased with his son's actions[3] and told the Sith Academy on the Imperial capital world of Dromund Kaas of his accomplishment. Veradun was to leave the estate and train at the academy to become a Sith Warrior.[11]
  
  The day before Veradun's departure his adoptive father took him on a tour of the zoo to teach him three lessons on personal conduct deception and expectations. The lessons which his father crafted through the use of the animals and their behavior had a profound impact on Veradun and shaped his philosophies for later in life. The next day Veradun was taken to Dromund Kaas[11] and he eventually became selected as an apprentice by the pureblood Sith Master Darth Vindican.[8] On a trip to the Outer Rim world of Geonosis Veradun discovered a young Twi'lek slave girl by the name of Eleena Daru. Upon seeing that Daru was abused and physically beaten by her owner Veradun killed her master and took the Twi'lek as his own. Although she remained his slave the two became lovers[3] and he eventually came to treat her as a wife[1] despite the Empire's anti-alien and anti inter-species marriaggepolicies.[3]
  
  It was thus that after being accepted as a Sith apprentice Veradun found a new name for himself: Malgus.
  
  The Great Galactic War: "After a thousand years Korriban is ours again." ― Darth Malgus following the fall of Korriban. In 3681 BBY the Empire returned from hiding and launched a series of attacks against the Galactic Republic sparking the Great Galactic War.[12] Vindican and his student were among those selected to participate in the Sith assault to reclaim the Sith holy world of Korriban and during the Battle of Korriban the two took a Fury-class Imperial interceptor to board the Republic's space station above the planet. Landing in the hangar and preventing the station's crew from escaping aboard the freighter there the two disembarked to confront the two Jedi who were entering the hangar.[8]
  
  While Vindican engaged the Zabrak Jedi Master Kao Cen Darach in battle Malgus attacked Darach's Padawan Satele Shan. The Sith easily overpowered the younger Human at first but a toss of Darach's lightsaber put Malgus on the defensive and allowed Shan to regain her footing. Malgus' master responded by unleashing a blast of lightning at Malgus' opponent but Darach again came to his student's rescue by blasting the warrior with the Force causing Vindican to change targets and attack the freighter nearby that belonged to a smuggler named Nico Okarr. Okarr was busy trying to start the ship so that he and the Jedi could escape while a Republic trooper named Jace Malcom defended the freighter from the Sith's attack by launching a rocket at him.[8]
  
  Vindican easily deflected the rocket but was enraged to see Darach order Shan to escape aboard the freighter. Angered that his opponent was escaping Malgus engaged Darach alongside his master while the Zabrak Battlemaster defended himself with both his and Shan's double-bladed lightsabers. Despite the Sith's advantage of numbers Darach easily beat back their attacks and scored a hit on Vindican's face before stabbing the Sith Master through his chest. Despite the fall of Malgus' master the younger Sith summoned Vindican's lightsaber to his hand and charged Darach batting aside the chunks of machinery and metal that the Jedi threw at him. Knocking Shan's lightsaber from Darach's grasp and battering down the Zabrak's defenses Malgus brought the duel to a close when he cut down the Jedi Master.[8]
  
  Malgus was surprised to find that his master was still alive and mocked Vindican for his failure to prevent the survivors' escape before decapitating the pureblood Sith as they watched the Sith armada descend on Korriban.[8] After the battle Malgus walked alone on Korriban's surface and experienced a Force vision in which the galaxy and the Republic burned. From then on Malgus believed that he would be responsible for the fall of the Republic and its Jedi Order.
  
  The Battle of Alderaan: In the years following the Battle of Korriban Malgus was promoted to the rank of Sith Lord[13] and around 3667 BBY[14] he was granted the title of Darth. Taking on the full name Darth Malgus he was selected to personally lead Imperial forces in a surprise attack on the peaceful planet of Alderaan in the Core Worlds. Timing his attack to coincide with an Imperial feint to draw the Republic fleet far from the Core Malgus landed thousands of assault droids and Imperial troopers accompanied by hundreds of Sith on Alderaan's surface after the Empire completed a vicious orbital bombardment.[13] Malgus himself led the Imperials on a march across the planet burning forests and destroying cities on a trek towards the capital city. However members of Havoc Squad—a unit from the Republic Special Forces—launched a guerrilla counterattack as the Sith Lord marched through a valley. In the years following the Battle of Korriban Malgus was promoted to the rank of Sith Lord[13] and around 3667 BBY[14] he was granted the title of Darth. Taking on the full name Darth Malgus he was selected to personally lead Imperial forces in a surprise attack on the peaceful planet of Alderaan in the Core Worlds. Timing his attack to coincide with an Imperial feint to draw the Republic fleet far from the Core Malgus landed thousands of assault droids and Imperial troopers accompanied by hundreds of Sith on Alderaan's surface after the Empire completed a vicious orbital bombardment.[13] Malgus himself led the Imperials on a march across the planet burning forests and destroying cities on a trek towards the capital city. However members of Havoc Squad—a unit from the Republic Special Forces—launched a guerrilla counterattack as the Sith Lord marched through a valley.
  
  "Defeat": The Sith forces were on retreat as reinforcements arrived from the Republic in the system to help the battered Republic defenders. Shan played a vital role in giving hope to the overwhelmed Republic forces on the ground.[15]
  
  Malgus survived the encounter and was picked up by his personal shuttle. Frustrated and enraged by the defeat he paid little attention to his wounds. His breathing sounded like a rasp over wood. His skin stung from burns. His lungs were damaged. Lacerations and contusions made a grim mosaic on his flesh. However Malgus felt no pain.
  
  Revenge and the Third Lesson: As he departed Alderaan Malgus sensed the presence of a Jedi within a ruined city on the planet. Desiring revenge against those who had deprived him of victory Malgus ordered his shuttle's pilot to turn the craft around and hover over the city. Against the protests of the pilot Malgus leaped from the craft to confront the Jedi within the city's ruined streets. Upon reaching the ground the Sith called upon the Jedi. A Zabrak Jedi came out from one of the buildings and recognized him igniting his two lightsabers in the process to face him — making his familiarity with Jar'Kai lightsaber combat style apparent. Malgus rushed towards the Zabrak Jedi to engage him but was caught off guard when his opponent used the Force to bring down two buildings (made of duracrete and steel) from the either side of the street on the Sith Lord in an attempt to kill him.[11]
  
  Malgus was trapped under a mountain of rubble and used the Force to prevent himself from getting crushed.[11] Dust made his already troubled breath more difficult. Malgus was so lost in his thirst for revenge that he failed to properly evaluate the power of his new Jedi opponent. With an effort of will he contained his anger controlled it and made it in to a tool to sharpen his power. Using the Force he blew tons of rubble up and away from him. It fell with a crash on adjacent buildings. Malgus jumped over the heap and landed on the street. The Zabrak Jedi was stunned. Malgus again charged towards his opponent and engaged him in a fierce lightsaber duel. Malgus unleashed a blizzard of lightsaber strikes which prevented the Zabrak Jedi to perform any counterattack. The Jedi retreated before the offensive desperately intercepting Malgus's blows. Malgus's lightsaber traced glittering red arcs through the air and he continued to push towards the Jedi. His opponent continued to give space. Malgus soon realized that the Zabrak Jedi was actually baiting him.[11]
  
  Malgus augmented his Force sense and felt a faint sign of the presence of another Jedi nearby. This Jedi was hiding in the ruins and was using the Force to suppress his signature. Malgus unleashed a barrage of overpowering strikes on the Zabrak Jedi and performed a Force-augmented spinning side kick to knock him out of the way. He then Force gripped the second Jedi pulled him out of the hiding and crushed his windpipe.[11]
  
  The murder of the second Jedi enraged the Zabrak Jedi and he charged towards Malgus. However the Sith Lord unleashed a powerful barrage of Force lightning which overwhelmed the defenses of his opponent and began to burn his flesh. But the Jedi staggered towards Malgus slowly under the cover of his lightsabers taking one step at a time regardless of his burns. Malgus channeled more power and forced the Jedi to his knees who screamed with pain. Malgus's lightning spiraled around the Jedi blasting dark holes in his body and his lightsabers fell on the ground. The Zabrak Jedi was ruined by his attack but was still alive. The Sith Lord took a moment to observe the look of failure in the Jedi's eyes and then impaled him. He remembered his third and final lesson from his foster father — sometimes there was just an empty cage — while rejoining his forces in retreat.[11]
  
  Following the battle on Alderaan Malgus was nursed back to health by Daru but jaw wounds he received during the battle forced him to don a respirator mask[3] that covered his nose mouth and neck.
  
  The Outer Rim: "The strength of my scream buckled the bridge's transparisteel viewport and left the crew's ears bleeding. More gratifyingly my raged overloaded the fuel slugs of an incoming wave of Aureks. The bright bursts of their deaths raised a smile." ― Darth Malgus describing the anger that he felt after sensing the death of Darth Venemal. 
  
  During the latter stages of the war Malgus led a campaign against the Republic in the Outer Rim and he kept a record of his experiences inside a personal journal. 129 days into his campaign Malgus's forces attacked the planet Ord Radama and Malgus and the Sith Lord Darth Venemal supervised the landing of Sith forces on the world. Malgus and Venemal then led a group of Sith infantry in an assault on a Republic gun emplacement that was located at the base of a cliff. While Venemal and a group of commandos disabled the guns Malgus led his remaining troops along a mountain pass and he used the Force to roll a large boulder along the trail to detonate a number of mines that lay in their way. Once he had reached the crest of the mountain Malgus rejoined Venemal's team and he congratulated the commandos after he learned that they had taken out a Republic stronghold. More Sith troops landed on Radama and a few days later Malgus gathered together his soldiers and gave them a speech to raise their spirits in preparation for an attack on Livien Magnus the capital city of Ord Radama.[17]
  
  Malgus' forces besieged Livien Magnus attempting to starve the city's inhabitants. A week into their attack Lord Adraas[17] a rival of Malgus[3] was sent to Ord Radama by the Emperor's advisory Dark Council to provide Malgus with assistance. Malgus was angered by Adraas' presence on the planet and when Adraas suggested that they send some Mark I and Mark II Sith war droids to clear a path to the city Malgus and Venemal did nothing to dissuade him despite doubting the droids' abilities. Under Adraas' orders the droids attacked the city's southern gate and Malgus watched on as the droids were exterminated by the Republic defenders. However the failure of the droids sufficiently distracted the Republic forces to allow Venemal and his commandos to enter the city and blast a whole in the wall. Livien Magnus quickly fell to Malgus' troops and Adraas subsequently tried to take all of the credit for the victory which led Malgus to further despise his rival.[17]
  
  Despite their initial success Malgus' forces were not resupplied and Malgus feared the Sith would loose control of Ord Radama. While the Ministry of Logistics was responsible for providing Malgus' troops with supplies Malgus lack sufficient influence over Minister Shullis Khamarr the leader of the Ministry to compel her to help him and instead he sent some requests for resources to War Minister Shareis. However Shareis did not respond and Khamarr failed to send Malgus any supplies and the Republic eventually sent a number of Hammerhead-class cruisers and Thranta-class corvettes to attack Malgus' ships in orbit of Ord Radama. From the balcony of a palace in Livien Magnus Malgus observed as Republic ships engaged his fleet so he boarded his personal shuttle and flew up to assume command of the dreadnaught Lindworm. However by the time Malgus arrived on the Lindworm's bridge the Sith had already lost the battle and he watched as a stricken Sith Harrower-class Dreadnaught plummeted into the atmosphere of Ord Radama and crashed into the center of Livien Magnus. Through the Force Malgus felt the deaths of Venemal and a hundred thousand of the city's inhabitants and he screamed out in anger. The power of his scream buckled the bridge's viewport caused the crew's ears to bleed and also destroyed a wave of Republic Aurek-class tactical strikefighters that were passing the vessel. Realizing that the Sith had no hope of defeating the Republic ships Malgus ordered his remaining forces to depart the system and jump to the heart of Sith Space.
  
  "We must now defend the heart of our own territory. I am enraged that the Dark Council allowed war to reach Ashas Ree yet I must allow some measure of admiration for the way the Republic has outmaneuvered us." ― Darth Malgus. After his withdrawal to Sith Space Malgus' forces were pursued by the Republic and a Republic fleet attacked the Sith world of Ziost. Malgus participated in the battle and the Sith failed to halt the advance of the Republic which soon launched a strike against the planet Ashas Ree. Malgus was dispatched to help defend Ashas Ree and once he arrived on the world he took command of a line of siege tanks and used them to hold off a series of attacks from Republic vehicles. The Sith forces were eventually victorious on Ashas Ree and in recognition of the role that Malgus played in the battle the Dark Council informed him that he would never again have to face shortage of resources like he had at Ord Radama.[17]
  
  After receiving word from Imperial Intelligence that Jedi Master Ven Zallow—the commander of the Republic forces that had participated in the Battle of Ashas Ree—was headquartered on the world Serenno Malgus activated a Cipher Agent a high-ranking Serenno noble who worked for Imperial Intelligence and the agent informed him the Republic was planning to move to a new forward base on the planet. In preparation for a Sith attack another Cipher Agent was ordered to assassinate Zallow to disrupt the Republic command structure and Malgus planned to lead a force of warships to Serenno once the agent had completed the assignment. When Malgus received word that the agent had been successful he ordered his fleet to jump to Serenno and he scattered a number Republic vessels that were orbiting the planet. Malgus then secured control of the villa of House Palerma which the Republic had been using as a command post and he was angered to discover that Zallow had killed Malgus' infiltrator and fled the world. The Serenno families House Comprassi and House Teramo objected to the presence of the Sith on their planet and they hired a group of mercenaries to attack the villa. However the mercenaries' attack was unsuccessful and Malgus observed from a parapet while some Sith assassins defeated the attackers.
  
  "The Sith Emperor has ordered us to recapture Ord Radama. I will lead the attack. There are rumors that some blame me for the death of Lord Venemal and the defeat suffered there. This campaign shall restore my honor and prove the fitness of the Sith Empire." ― Darth Malgus. A number of rumors circulated that claimed that some among the Sith blamed Malgus for the death of Darth Venemal and when the Sith Emperor ordered Malgus to recapture Ord Radama Malgus believed that the attack would give him an opportunity to restore his honor. Leaving nothing to chance Malgus planned to lead a regiment of Sith Warriors in an assault on New Raido Ord Radama's new capital city with droids troopers and commandos to join him once he had breached the city's defenses. The battle waged on for a number of weeks and Malgus suffered a number of setbacks as a result of the actions of the Jedi. However he reveled in the bloodbath of the battle despite the fact that the slow pace of the assault cost him his favor with the Dark Council. He remained certain that he would achieve victory on the world and that his triumph would earn him a place in Sith army that was gathering to attack the Republic's capital world of Coruscant. Malgus also suspected that the power source of the Dark Reaper a superweapon used during the Great Sith War was located on Ord Radama.[17]
  
  Malgus later began to assemble a task force in preparation for an assault on Republic-controlled space in the Core Worlds and the Dark Council placed at his disposal 4 Harrower battle cruisers 48 Fury-class Imperial interceptors and 192 ISF interceptors.
  
  The Sacking of Coruscant: In 3653 BBY twenty-eight years after the war's beginning the Dark Council contacted the Republic Senate expressing their wish to negotiate an end to the conflict. While delegations from the Empire the Senate and the Jedi Order prepared to meet on Alderaan to form a peace agreement the Sith made preparations for their strike on Coruscant.[18] The high-ranking Sith Lord Darth Angral was placed in charge of the entire operation while Darth Malgus was chosen to lead an early attack on the Temple of the Jedi Order. Under the impression that the Empire would invade Coruscant and proceed to wipe it clean of life via orbital bombardment Malgus eagerly accepted the responsibility believing it to be the fruition of his vision on Korriban that foretold his destruction of the Republic. Malgus's attack plan involved him entering the Temple wherein he would distract the Jedi while a force of fifty Sith Warriors infiltrated the ancient edifice[3] and destroyed the planetary defense grid mainframe within.[19] Although Malgus requested that he be the preliminary attack's sole leader Angral insisted that Malgus' rival Lord Adraas a political ally of Angral's act as the second-in-command by overseeing the fifty-man infiltration team.
  
  The long history of Darth Malgus continues on, but for now, we must end the long story of Darth Malgus here.`,
];

const wordList =
  passages[Math.floor(Math.random() * passages.length)].split(/\s+/g);

const $$ = document.querySelectorAll.bind(document);

// Add words to word-section
function addWords() {
  // Clear existing word-section
  const wordSection = $$("#word-section")[0];
  wordSection.innerHTML = "";
  $$("#typebox")[0].value = "";

  for (let index = 0; index < wordList.length; index++) {
    const wordSpan = `<span>${wordList[index]}</span>`;
    wordSection.innerHTML += wordSpan;
  }

  // Mark first word as current-word
  wordSection.firstChild.classList.add("current-word");
}

// Word Colors
const colorCurrentWord = "#dddddd";
const colorCorrectWord = "#93C572";
const colorIncorrectWord = "#e50000";

// Word Count and other data.
const wordData = {
  seconds: 900,
  correct: 0,
  incorrect: 0,
  total: 0,
  typed: 0,
};

function checkWord(word) {
  const wlen = word.value.length;
  const wval = word.value.trim();

  // How much we have of the current word.
  const current = $$(".current-word")[0];
  const currentSubstring = current.innerHTML.substring(0, wlen);

  // Check if we have any typing errors and make sure there is a real
  // word to check https://github.com/anschwa/typing-test/issues/2
  const noMatch = wval !== currentSubstring;
  const emptyWords = wval === "" || currentSubstring === "";

  if (noMatch || emptyWords) {
    current.classList.add("incorrect-word-bg");
    return false;
  } else {
    current.classList.remove("incorrect-word-bg");
    return true;
  }
}

function submitWord(word) {
  // Update current-word and keep track of correct & incorrect words
  const current = $$(".current-word")[0];

  if (checkWord(word)) {
    current.classList.remove("current-word");
    current.classList.add("correct-word-c");
    wordData.correct += 1;
  } else {
    current.classList.remove("current-word", "incorrect-word-bg");
    current.classList.add("incorrect-word-c");
    wordData.incorrect += 1;
  }

  // Update wordData
  wordData.total = wordData.correct + wordData.incorrect;

  // Make the next word the new current-word.
  current.nextSibling.classList.add("current-word");
}

function clearLine() {
  // Remove past words once you get to the next line
  const wordSection = $$("#word-section")[0];
  const current = $$(".current-word")[0];
  const previous = current.previousSibling;
  const children = $$(".correct-word-c, .incorrect-word-c").length;

  // <span>'s on the next line have a greater offsetTop value than
  // those on the top line. Remove words until the first word on the
  // second line is the fistChild of word-section.
  if (current.offsetTop > previous.offsetTop) {
    for (let i = 0; i < children; i++) {
      wordSection.removeChild(wordSection.firstChild);
    }
  }
}

let typingTimer = null;
function isTimer(seconds) {
  // BUG: page refresh with keyboard triggers onkeyup and starts timer
  const time = $$("#timer > span")[0].innerHTML;
  if (time === "0:00") {
    return false;
  }

  // Only set timer once
  if (time === "15:00" && typingTimer === null) {
    typingTimer = window.setInterval(() => {
      if (seconds <= 0) {
        window.clearInterval(typingTimer);
      } else {
        seconds -= 1;
        const timePad = seconds < 10 ? "0" + seconds : seconds; // Zero padded

        $$("#timer > span")[0].innerHTML = `0:${timePad}`;
      }
    }, 1000);
  }

  return true;
}

function calculateWPM(data) {
  const { seconds, correct, incorrect, total, typed } = data;
  const minutes = seconds / 900;
  const wpm = Math.max(0, Math.ceil((typed / 5 - incorrect) / minutes));
  const accuracy = Math.ceil((correct / total) * 100);

  const results = `
<ul id="results">
  <li>WPM: <span class="wpm-value">${wpm}</span></li>
  <li>Accuracy: <span class="wpm-value">${accuracy}%</span></li>
  <li id="results-stats">
    Total Words: <span>${total}</span> |
    Correct Words: <span>${correct}</span> |
    Incorrect Words: <span>${incorrect}</span> |
    Characters Typed: <span>${typed}</span>
  </li>
</ul>
`;

  $$("#word-section")[0].innerHTML = results;

  // Color-code accuracy
  const wpmClass = $$("li:nth-child(2) .wpm-value")[0].classList;
  if (accuracy > 80) {
    wpmClass.add("correct-word-c");
  } else {
    wpmClass.add("incorrect-word-c");
  }

  //   console.log(wordData);
}

function typingTest(e) {
  const SPACE = 32;

  // Get key code of current key pressed.
  e = e || window.event;
  const kcode = e.keyCode;
  const word = $$("#typebox")[0];

  // Check if empty (starts with space)
  if (word.value.match(/^\s/g)) {
    word.value = "";
    return;
  }

  // Display typing test results when timer runs out.
  const isGameover = !isTimer(wordData.seconds);
  if (isGameover) {
    calculateWPM(wordData);
    return;
  }

  // Otherwise, keep score when timer is on.
  checkWord(word);
  if (kcode === SPACE) {
    submitWord(word);
    clearLine();

    $$("#typebox")[0].value = "";
  }

  wordData.typed += 1;
}

function restartTest() {
  $$("#typebox")[0].value = "";
  window.location.reload();
}

/**
 * Builds the typing test HTML and all
 * @param id Name of the element to place the typing test inside of
 */
function buildTypingTest(id) {
  // inject the CSS
  let styles = `#typing-test {margin: 0 auto;}#typing-test > section {padding: 0.5em;margin: 0 auto;}#timer,#restart {margin: 0.2em;line-height: 2.2em;height: 2.2em;}#word-section {width: 86%;font-size: 1.5em;height: 4em;line-height: 2em;border-radius: 0.25em;position: relative;overflow: hidden;}#word-section > span {display: inline-block;margin-left: 0.2em;}#type-section {text-align: center;}#type-section > * {font-size: 1.5em;display: inline-block;border-radius: 0.25em;color: #fff;vertical-align: middle;}#typebox {width: 64%;color: #000;padding: 0.5em;}#timer {width: 4em;background-color: #21557f;margin-right: 0;}#restart {width: 2em;background-color: #437ea1;}#restart > span {display: inline-block;transform: rotate(1.5rad);font-weight: bold;}#restart:hover {background-color: #21557f;}#results {text-align: center;margin: 0 1%;display: block;}#results li {list-style: none;}#results li:first-child {font-size: 1.5em;}#results li:nth-child(2) {font-size: 0.8em;line-height: 1em;}#results #results-stats {font-size: 0.6em;}footer {margin-top: 1em;text-align: center;font-size: 0.8em;color: #000;}footer a {color: #000;text-decoration: none;}footer a:hover {text-decoration: underline;}.magic-box {position: fixed;width: inherit;height: 0.5em;top: 54px;background-color: #fff;}.waiting {text-align: center;line-height: 1.5em;font-size: 3em;}.current-word {background-color: #dddddd;}.correct-word-c {color: #93c572;}.incorrect-word-c {color: #e50000;}.incorrect-word-bg {background-color: #e50000;}`;
  var styleSheet = document.createElement("style");
  styleSheet.type = "text/css";
  styleSheet.innerText = styles;
  document.head.appendChild(styleSheet);

  // add the HTML
  let tag = document.getElementById(id);
  tag.innerHTML = `
    <div id="typing-test">
      <section id="word-section">
        <div class="waiting">&#9203;</div>
      </section>

      <section id="type-section">
        <input id="typebox" name="typebox" type="text" tabindex="1" autofocus onkeyup="typingTest(event)" />
        <div id="timer" class="type-btn"><span>1:00</span></div>
        <button id="restart" class="type-btn" tabindex="2" onclick="restartTest()">
          <span id="restart-symbol">&#8635;</span>
        </button>
      </section>
    </div>
  `;
  addWords();
}

/**
 * Adapted from https://github.com/anschwa/typing-test/
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Adam Schwartz
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
